<!DOCTYPE html>
<html lang="en">
<head>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link rel="manifest" href="/manifest.json">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial scale=1.0">
    <meta name="theme-color" content="#2196F3" />
    <link rel="icon" type="image/png" href="img/opened-book-icon.png" purpose="any" >
    <title> Book database</title>
    <style>
      .search-result{
        width: calc(100% / 3);
        float: left;
        padding: 10px;
        box-sizing: border-box;
      }
      .search-result img{
        max-width: 100%;
        height: auto;
        display: block;
        margin: 0 auto;
      }
      
    </style>
<script>navigator.serviceWorker.register("service-worker.js")</script> 
  
</head>
<body style="background-color: bisque;">
  <div x-data="app">
    <h1>Search for books</h1>
    <input type="text" x-model="query" placeholder="search" style="width: calc(100%-100px); float: left;" @keydown.enter="search()" >
    <button @click="search()">Search</button>
    <div x-html = "searchResults"></div>
  </div>
  <script>
    const app = {
      query : '',
      searchResults: '',
      search(){
        if (this.query.trim() !== ""){
          const apiUrl = `https://openlibrary.org/search.json?q=${this.query.trim()}`;
          fetch(apiUrl)
            .then(response => response.json())
            .then(data=> {
              let resultHTML= '';
              const results = data.docs;
              results.forEach((book, index) => {
                const {title, author_name, publish_year, cover_i, key} = book;
                const year = book.publish_year ? book.publish_year[0] : "Unknown";
                const coverId = book.cover_i ? book.cover_i:null;
                const coverUrl = coverId ? `https://covers.openlibrary.org/b/id/${coverId}-L.jpg` : "No cover available";
                const bookUrl = key ? `details.html?key=${key}` : "#";

                resultHTML += `
                  <div class="search-result">
                    <strong><b>Title:</b></strong> ${title}<br>
                    <strong><b>Year:</b></strong> ${year}<br>
                    <a href = "${bookUrl}" target = "_blank"> View Details</a>
                    <img src="${coverUrl}" alt="No cover">
                  </div>`;
                if ((index+1) % 3 === 0){
                  resultHTML += '<div style="clear:both;"></div>';
                }
            });
            this.searchResults = resultHTML;
          })
          .catch(error => {
            console.error(error);
            });
        } else{
          alert("Please enter a search query.");
        }
      }
    };
    </script>
</body>
</html>